<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Calculator</title>
  <!-- 引用CSS -->
  <link href="./css/bootstrap.min.css" rel="stylesheet">
  <link href="./css/table_display.css" rel="stylesheet">
  

  <style>
    .matrix-input {
        width: 3.5em;
    }

    /* 關掉input number的上下鍵 */
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    .matrixContainer {
        margin-top: 10px;
        /* display: flex;
        justify-content: center; */
    }

    .rows-cols-control {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .midOperator {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        margin-left: 20px;
        margin-right: 20px;
    }

    .operatorButton {
        width: 3em;
        margin-top: 0.2em;
        text-align: center;
    }
  </style>
  
</head>
<body>
    <!-- 網頁列表 -->
    <div class="container">
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand" href="./Home_page.html">Calculator</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                    <a class="nav-link" href="./Simple_Calculator.html">Simple calculate</a>
                    </li>
                    <!-- Dropdown -->
                     <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Another Calculate
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">Calculas</a></li>
                        <li><a class="dropdown-item" href="#">Vector</a></li>
                        <li><a class="dropdown-item" href="#">Matrix</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#">More...</a></li>
                    </ul>
                    </li>

                    <li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                    </li>
                    <!-- dark mode switch -->
                    <li class="nav-item form-check form-switch d-flex align-items-center">
                        <input class="form-check-input ms-auto" type="checkbox" id="themeToggle">
                        <label class="form-check-label" for="themeToggle">Dark Mode</label>
                    </li>
                </ul>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>
                </div>
            </div>
        </nav>
        
    </div>

    <h1 style="text-align: center; font-style: inherit; padding-top: 10px;">矩陣計算機</h1>
    <div class="container" style="margin-top: 50px;">
        <!-- 矩陣計算機 -->
        <div class="row d-flex justify-content-center">
            <div class="rows-cols-control col">
                <div class="" style="width: 280px; text-align: center;">
                    <label>行數：<input type="number" id="rows-A" value="3" min="1" style="width: 2em;" /></label>
                    <label>列數：<input type="number" id="cols-A" value="3" min="1" style="width: 2em;" /></label>
                    >>
                    <button onclick="createMatrix(`matrixContainerA`, `A`)">創建矩陣</button>
                </div>
                
                <div class="matrixContainer" id="matrixContainerA">
                    <table class="matrix-table">
                        <tr>
                            <td><input type="number" class="matrix-input" id="cellA-0-0"></td>
                            <td><input type="number" class="matrix-input" id="cellA-0-1"></td>
                            <td><input type="number" class="matrix-input" id="cellA-0-2"></td>
                        </tr>
                        <tr>
                            <td><input type="number" class="matrix-input" id="cellA-1-0"></td>
                            <td><input type="number" class="matrix-input" id="cellA-1-1"></td>
                            <td><input type="number" class="matrix-input" id="cellA-1-2"></td>
                        </tr>
                        <tr>
                            <td><input type="number" class="matrix-input" id="cellA-2-0"></td>
                            <td><input type="number" class="matrix-input" id="cellA-2-1"></td>
                            <td><input type="number" class="matrix-input" id="cellA-2-2"></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="midOperator col">
                <button onclick="swapMatrices()" class="operatorButton">A⇆B</button>
                <button onclick="addMatrice()" class="operatorButton">A+B</button>
                <button onclick="subtractMatrices()" class="operatorButton">A-B</button>
                <button onclick="" class="operatorButton">A*B</button>
            </div>
            <div class="rows-cols-control col">
                <div class="" style="width: 280px; text-align: center;">
                    <label>行數：<input type="number" id="rows-B" value="3" min="1" style="width: 2em;" /></label>
                    <label>列數：<input type="number" id="cols-B" value="3" min="1" style="width: 2em;" /></label>
                    >>
                    <button onclick="createMatrix(`matrixContainerB`, `B`)">創建矩陣</button>
                </div>
                
                <div class="matrixContainer" id="matrixContainerB">
                    <table class="matrix-table">
                        <tr>
                            <td><input type="number" class="matrix-input" id="cellB-0-0"></td>
                            <td><input type="number" class="matrix-input" id="cellB-0-1"></td>
                            <td><input type="number" class="matrix-input" id="cellB-0-2"></td>
                        </tr>
                        <tr>
                            <td><input type="number" class="matrix-input" id="cellB-1-0"></td>
                            <td><input type="number" class="matrix-input" id="cellB-1-1"></td>
                            <td><input type="number" class="matrix-input" id="cellB-1-2"></td>
                        </tr>
                        <tr>
                            <td><input type="number" class="matrix-input" id="cellB-2-0"></td>
                            <td><input type="number" class="matrix-input" id="cellB-2-1"></td>
                            <td><input type="number" class="matrix-input" id="cellB-2-2"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <hr>
            <div id="matrix-output">output</div>
    </div>


    <!-- 引用JS -->
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.4.0/math.min.js"></script>
    <script src="./js/darrkmode.js"></script>

    <script>
        // 創建矩陣，同時盡量保留之前輸出的資料
        function createMatrix(matrixContainer, ID) {
        // 先讀出舊尺寸
        let oldRows = parseInt(document.getElementById(`rows-${ID}`).value);
        let oldCols = parseInt(document.getElementById(`cols-${ID}`).value);

        // 儲存舊資料
        let oldData = [];
        for (let i = 0; i < oldRows; i++) {
            let row = [];
            for (let j = 0; j < oldCols; j++) {
                const cell = document.getElementById(`cell${ID}-${i}-${j}`);
                row.push(cell ? parseFloat(cell.value) || 0 : 0);
            }
            oldData.push(row);
        }

        // 取得新尺寸
        const rows = parseInt(document.getElementById(`rows-${ID}`).value);
        const cols = parseInt(document.getElementById(`cols-${ID}`).value);
        const container = document.getElementById(matrixContainer);

        // 建立新矩陣
        let table = "<table class='matrix-table'>";
        for (let i = 0; i < rows; i++) {
            table += "<tr>";
            for (let j = 0; j < cols; j++) {
                let value = (oldData[i] && oldData[i][j] !== undefined) ? oldData[i][j] : 0;
                table += `<td><input type="number" class="matrix-input" id="cell${ID}-${i}-${j}" value="${value}"/></td>`;
            }
            table += "</tr>";
        }
        table += "</table>";
        container.innerHTML = table;

        // 清空輸出
        document.getElementById("matrix-output").innerHTML = "";
    }

        // 顯示矩陣
        function displayMatrix(matrix, title="result"){
            let resultHtml = `<h3>${title}</h3><math><mtable class='matrix-table'>`;
            for (let i=0; i<matrix.length; i++) {
                resultHtml += "<mtr>";
                for (let j=0; j<matrix[i].length; j++) {
                    resultHtml += `<mtd>${matrix[i][j]}</mtd>`;
                }
                resultHtml += "</mtr>";
            }
            resultHtml += "</mtable></math>";
            document.getElementById("matrix-output").innerHTML = resultHtml;
        }

        // 獲取矩陣數據
        function getMatrix(ID) {
            const rows = parseInt(document.getElementById(`rows-${ID}`).value);
            const cols = parseInt(document.getElementById(`cols-${ID}`).value);
            let matrix = [];

            for (let i = 0; i < rows; i++) {
                let row = [];
                for (let j = 0; j < cols; j++) {
                    const value = parseFloat(document.getElementById(`cell${ID}-${i}-${j}`).value) || 0;
                    row.push(value);
                }
                matrix.push(row);
            }
            return matrix;
        }

        // A和B矩陣互換
        function swapMatrices() {

            const matrixA = getMatrix('A');
            const matrixB = getMatrix('B');
            // 交換矩陣A和B的容器內容
            createMatrix(`matrixContainerA`, `B`);
            createMatrix(`matrixContainerB`, `A`);
            let tempRows = document.getElementById(`rows-A`).value;
            let tempCols = document.getElementById(`cols-A`).value;
            document.getElementById(`rows-A`).value = document.getElementById(`rows-B`).value;
            document.getElementById(`cols-A`).value = document.getElementById(`cols-B`).value;
            document.getElementById(`rows-B`).value = tempRows;
            document.getElementById(`cols-B`).value = tempCols;
            // 將B矩陣放入A
            let tableA = "<table class='matrix-table'>";
            for (let i = 0; i < matrixB.length; i++) {
                tableA += "<tr>";
                for (let j = 0; j < matrixB[i].length; j++) {
                    tableA += `<td><input type="number" class="matrix-input" id="cellA-${i}-${j}" value="${matrixB[i][j]}" /></td>`;
                }
                tableA += "</tr>";
            }
            tableA += "</table>";
            document.getElementById("matrixContainerA").innerHTML = tableA;
            // 將A矩陣放入B
            let tableB = "<table class='matrix-table'>";
            for (let i = 0; i < matrixA.length; i++) {
                tableB += "<tr>";
                for (let j = 0; j < matrixA[i].length; j++) {
                    tableB += `<td><input type="number" class="matrix-input" id="cellB-${i}-${j}" value="${matrixA[i][j]}" /></td>`;
                }
                tableB += "</tr>";
            }
            tableB += "</table>";
            document.getElementById("matrixContainerB").innerHTML = tableB;
        }

        // A和B矩陣相加
        function addMatrice() {
            // 獲取矩陣A和B
            const matrixA = getMatrix('A');
            const matrixB = getMatrix('B');

            if (matrixA.length !== matrixB.length || matrixA[0].length !== matrixB[0].length) {
                alert("矩陣維度不匹配，無法相加！");
                return;
            }

            const result = math.add(matrixA, matrixB);
            displayMatrix(result, "A + B");
        }

        // A和B矩陣相減
        function subtractMatrices() {
            // 獲取矩陣A和B
            const matrixA = getMatrix('A');
            const matrixB = getMatrix('B');

            if (matrixA.length !== matrixB.length || matrixA[0].length !== matrixB[0].length) {
                alert("矩陣維度不匹配，無法相減！");
                return;
            }

            const result = math.subtract(matrixA, matrixB);
            displayMatrix(result, "A - B");
        }
        
        // A和B矩陣相乘
        
        </script>
</body>
</html>